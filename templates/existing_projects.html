<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Existing Projects</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f0f4f8;
      padding: 40px;
    }

    h2 {
      text-align: center;
      margin-bottom: 30px;
    }

    .project-card {
      background-color: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .project-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .delete-project-btn {
      background-color: red;
      color: white;
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .delete-project-btn:hover {
      background-color: darkred;
    }

    .delete-file-btn {
      color: red;
      border: none;
      background: none;
      cursor: pointer;
    }

    .delete-file-btn:hover {
      text-decoration: underline;
    }

    .member-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 15px;
    }

    .member-card {
      background-color: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      width: 300px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .member-card p {
      margin: 8px 0;
    }

    .member-name {
      font-weight: bold;
      color: #007bff;
    }

    .reports {
      margin-top: 20px;
    }
    .alert.success {
  color: green;
  background-color: #e6ffe6;
  padding: 10px;
  border: 1px solid green;
  border-radius: 5px;
  margin-bottom: 15px;
}

  </style>
</head>
<body>
  <h2>üìÅ Existing Projects</h2>
<form method="GET" action="{{ url_for('existing_projects') }}" style="text-align:center; margin-bottom: 20px;">
  <input type="text" name="search_name" placeholder="Enter Project Name" required
         style="padding: 8px; width: 250px; border-radius: 5px; border: 1px solid #ccc;">
  <button type="submit" style="padding: 8px 16px; background-color: #007bff; color: white;
          border: none; border-radius: 5px;">Search</button>
</form>


  {% for project in projects %}
  <div class="project-card">
    <div class="project-header">
      <h3>Project: {{ project[1] }}</h3>
      <a href="{{ url_for('edit_project', project_id=project[0]) }}">‚úèÔ∏è Edit Project</a>
      <form method="POST" action="{{ url_for('delete_project', project_id=project[0]) }}" onsubmit="return confirm('Are you sure you want to delete this project?');">
        <button type="submit" class="delete-project-btn">üóëÔ∏è Delete Project</button>
      </form>
    </div>

   <p><strong>Project ID:</strong> {{ project[0] }}</p>
<p><strong>Manager:</strong> {{ project[2] }}</p>  <!-- if project[2] is manager -->


    <h4>Team Members ({{ members_by_project[project[0]]|length }}):</h4>
    <div class="member-cards">
      {% for member in members_by_project[project[0]] %}
        <div class="member-card">
          <p class="member-name">{{ member.name }}</p>
          <p><strong>Email:</strong> {{ member.email }}</p>
          <p><strong>Phone:</strong> {{ member.phone }}</p>
        </div>
      {% endfor %}
    </div>


<form method="POST" action="{{ url_for('generate_project_report') }}">
  <div class="file-section">
    {% for file in files[project[0]] %}
      <input type="checkbox" name="selected_files" value="{{ file[1] }}" class="file-checkbox"> {{ file[0] }}<br>
    {% endfor %}

    <label>
      <input type="checkbox" class="select-all"> Select All
    </label>
  </div>

  <input type="hidden" name="project_id" value="{{ project[0] }}">
  <br><br>
  <button type="submit">Generate Quality Report</button>
</form>

<script>
  document.querySelectorAll('.select-all').forEach(selectAllCheckbox => {
    selectAllCheckbox.addEventListener('change', function () {
      const section = this.closest('.file-section');
      const checkboxes = section.querySelectorAll('.file-checkbox');
      checkboxes.forEach(cb => cb.checked = this.checked);
    });
  });
</script>


    <h4 class="reports">Reports:</h4>
    <ul>
      {% for file in files[project[0]] %}
        <li>
          {{ file[0] }} -
          <a href="{{ url_for('download_file', filename=file[1]) }}">üì• Download</a>

          <form method="POST" action="{{ url_for('delete_file', file_id=file[2]) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this file?');">
            <button type="submit" class="delete-file-btn">üóëÔ∏è Delete</button>
          </form>
        </li>
      {% endfor %}
    </ul>
  </div>
  {% endfor %}
{% if session['role'] == 'admin' %}
  <a href="{{ url_for('admin_dashboard') }}" class="btn btn-primary">Back to Dashboard</a>
{% elif session['role'] == 'manager' %}
  <form action="{{ url_for('project_options') }}" style="margin-top: 28px;">
    <button type="submit" class="btn btn-secondary">‚Üê Back to Project Options</button>
  </form>
{% endif %}



{% if request.args.get('search_id') and not projects %}
<script>
  alert("Project with ID {{ request.args.get('search_id') }} does not exist.");
  window.location.href = "{{ url_for('existing_projects') }}";
</script>
{% endif %}

<script>
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        alert("{{ message }}");
      {% endfor %}
    {% endif %}
  {% endwith %}
</script>


</body>
</html>
